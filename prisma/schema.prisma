generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  userId          String           @id @unique
  blacklisted     Blacklist? // Blacklist record if the user is blacklisted
  infractions     Infraction[] // Infractions received
  messageBuilders MessageBuilder[] // MessageBuilder records created by the user
}

model Guild {
  guildId    String       @id @unique
  Infraction Infraction[] // Infractions issued in this guild
}

model Blacklist {
  user        User      @relation(fields: [userId], references: [userId])
  userId      String    @unique // UserId who is blacklisted
  moderatorId String // ModeratorId who blacklisted the user
  reason      String // The reason for the blacklist
  createdAt   DateTime  @default(now()) // When the blacklist was created
  expiresAt   DateTime? // When the blacklist expires

  @@index([moderatorId], name: "blacklist_moderator")
}

model Infraction {
  id          String         @id @default(uuid())
  user        User           @relation(fields: [userId], references: [userId])
  guild       Guild          @relation(fields: [guildId], references: [guildId])
  userId      String // UserId who received the infraction
  guildId     String // GuildId where the infraction was issued
  moderatorId String // ModeratorId who issued the infraction
  reason      String // The reason for the infraction
  type        InfractionType // The type of infraction
  createdAt   DateTime       @default(now()) // When the infraction was created
  expiresAt   DateTime? // When the infraction expires
  isActive    Boolean?       @default(false) // Set to false if expired and the user was unbanned

  @@index([userId], name: "infraction_user")
  @@index([guildId], name: "infraction_guild")
  @@index([userId, guildId], name: "infraction_user_guild")
  @@index([moderatorId, guildId], name: "infraction_moderator_guild")
  @@index([type], name: "infraction_type")
}

model MessageBuilder {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [userId])
  userId    String // UserId who created the message
  guildId   String? // GuildId where the message was created
  channelId String // ChannelId where the message was created
  messageId String? // MessageId of the message
  content   String? // Content of the message
  embed     Json? // Embeds associated with the message
  createdAt DateTime @default(now()) // When the message was created
  updatedAt DateTime @updatedAt // When the message was last updated

  @@index([userId], name: "messagebuilder_user")
  @@index([guildId], name: "messagebuilder_guild")
  @@index([channelId], name: "messagebuilder_channel")
  @@index([messageId], name: "messagebuilder_message")
}

enum InfractionType {
  Ban
  Tempban
  Unban
  Kick
  Timeout
  Warn
}
